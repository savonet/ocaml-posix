(executable
 (name gen_stubs)
 (modules gen_stubs)
 (libraries posix-socket.stubs posix-base))

(executable
 (name gen_types_c)
 (modules gen_types_c)
 (libraries posix-socket.types posix-base))

(rule
 (targets gen_types.c)
 (action
  (run ./gen_types_c.exe %{targets})))

(rule
 (target clibs_include_path)
 (action
  (with-stdout-to
   %{target}
   (run %{exe:../../../posix-base/src/posix_base_dirname_internal.exe} %{lib:ctypes:ctypes_cstubs_internals.h}))))

(rule
 (targets gen_types_c_target.exe)
 (deps
  (:c_code ./gen_types.c))
 (action
  (run
   %{ocaml-config:c_compiler}
   -I
   %{read-lines:clibs_include_path}
   -I
   %{ocaml-config:standard_library}
   -o
   %{targets}
   %{c_code})))

(executable
 (name gen_constants_c)
 (modules gen_constants_c)
 (libraries posix-socket.constants posix-base))

(rule
 (targets gen_constants.c)
 (action
  (run ./gen_constants_c.exe %{targets})))

(rule
 (targets gen_constants_c_target.exe)
 (deps
  (:c_code ./gen_constants.c))
 (action
  (run
   %{ocaml-config:c_compiler}
   -I
   %{read-lines:clibs_include_path}
   -I
   %{ocaml-config:standard_library}
   -o
   %{targets}
   %{c_code})))
